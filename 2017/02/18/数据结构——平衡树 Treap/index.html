<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/aaa.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/aaa.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/aaa.png?v=5.1.4">


  <link rel="mask-icon" href="/images/aaa.png?v=5.1.4" color="#222">





  <meta name="keywords" content="计算机,算法,数据结构," />










<meta name="description" content="数据结构之平衡树（树堆）的原理与应用.">
<meta name="keywords" content="计算机,算法,数据结构">
<meta property="og:type" content="article">
<meta property="og:title" content="数据结构——平衡树 Treap">
<meta property="og:url" content="http://lizhechen.com/2017/02/18/数据结构——平衡树 Treap/index.html">
<meta property="og:site_name" content="Zhechen&#39;s Personal Website">
<meta property="og:description" content="数据结构之平衡树（树堆）的原理与应用.">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-07-30T16:17:04.015Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据结构——平衡树 Treap">
<meta name="twitter:description" content="数据结构之平衡树（树堆）的原理与应用.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'zhechen'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lizhechen.com/2017/02/18/数据结构——平衡树 Treap/"/>





  <title>数据结构——平衡树 Treap | Zhechen's Personal Website</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zhechen's Personal Website</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Primes are lonely.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/diary/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            日程
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lizhechen.com/2017/02/18/数据结构——平衡树 Treap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzcwr">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhechen's Personal Website">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">数据结构——平衡树 Treap</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-18T22:02:59+08:00">
                2017-02-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
              <div class="post-description">
                  数据结构之平衡树（树堆）的原理与应用.
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="treap概述">Treap概述</h2>
<p>Treap是一种平衡二叉树，不过Treap会记录一个优先级（一般来说是随机生成），即Treap在以关键码构成二叉搜索树的同时，还会按照优先级的高低满足堆的性质，因此得名Treap（Tree + Heap）。 Treap不是二叉堆，二叉堆必须是完全二叉树，但Treap不必是。</p>
<p>对于每个结点，该结点的优先级不大于其所有孩子的优先级。Treap引入优先级的原因就是防止BST（二叉搜索树）退化成一条链，从而影响查询效率。</p>
<p>所以对于结点上的关键字来说，它是一颗BST，而对于结点上的优先级来讲，它是一个小顶堆。其平均查找长度为<span class="math inline">\(~O(\log n)~\)</span>。 Treap有插入、删除、旋转和查询等基本操作，进而可以实现查询第<span class="math inline">\(~k~\)</span>大和查询关键字<span class="math inline">\(~x~\)</span>排名等功能。</p>
<h2 id="treap的结构">Treap的结构</h2>
<p>Treap是一颗BST，所以Treap的每一个结点都需要记录一个关键字和两个儿子指针； Treap又是一个小顶堆，所以需要记录一个优先级。 结点的构建方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct Treap_Node</span><br><span class="line">&#123;</span><br><span class="line">    Treap_Node *left, *right; // 儿子指针</span><br><span class="line">    int value, fix; // 值和优先级</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="treap的操作">Treap的操作</h2>
<h3 id="旋转">旋转</h3>
<p>Treap本身对于关键字的构建和二叉查找树相同，但为对优先级维持其最小堆的性质，需要对树的结构进行调整，称为旋转，其操作方式如下：</p>
<ul>
<li><strong>左旋</strong>：将子树的根结点旋转到其根的左子树位置，同时根节点的右子节点成为该子树的根；</li>
<li><strong>右旋</strong>：将子树的根结点旋转到其根的右子树位置，同时根节点的左子节点成为该子树的根。</li>
</ul>
<p>例如下面这两棵树（表示方法为<code>[关键字-优先级]</code>）可以互相对根结点旋转得到：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      [<span class="number">4</span><span class="number">-3</span>]                       [<span class="number">2</span><span class="number">-1</span>]</span><br><span class="line">      /   \     ==== 左旋 ===&gt;    /   \</span><br><span class="line">   [<span class="number">3</span><span class="number">-1</span>] [<span class="number">5</span><span class="number">-5</span>]                 [<span class="number">1</span><span class="number">-2</span>] [<span class="number">4</span><span class="number">-3</span>]</span><br><span class="line">   /   \        &lt;=== 右旋 ====       /   \</span><br><span class="line">[<span class="number">1</span><span class="number">-2</span>] [<span class="number">2</span><span class="number">-4</span>]                       [<span class="number">3</span><span class="number">-4</span>] [<span class="number">5</span><span class="number">-5</span>]</span><br></pre></td></tr></table></figure>
<p>旋转的实例代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Left_Rotate</span><span class="params">(Treap_Node *&amp;a)</span> <span class="comment">//左旋 节点指针一定要传递引用</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Treap_Node *b = a -&gt; right;</span><br><span class="line">  a -&gt; right = b -&gt; left;</span><br><span class="line">  b -&gt; left = a;</span><br><span class="line">  a = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Right_Rotate</span><span class="params">(Treap_Node *&amp;a)</span> <span class="comment">//右旋 节点指针一定要传递引用</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Treap_Node *b = a -&gt; left;</span><br><span class="line">  a -&gt; left = b -&gt; right;</span><br><span class="line">  b -&gt; right = a;</span><br><span class="line">  a = b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以用下标来压缩代码量，具体实现方法在后边的模板给出。</p>
<h3 id="插入">插入</h3>
<p>在Treap中插入元素的法则与在BST中插入的法则相同，但插入完成后可能会破坏堆的性质，所以插入完成后要进行旋转，具体方法如下：</p>
<ol style="list-style-type: decimal">
<li>从根结点开始访问；</li>
<li>若当前结点为空，则直接插入，否则执行下一步；</li>
<li>递归访问左右子树：</li>
</ol>
<ul>
<li>若插入的关键字小于当前访问结点，则访问其左子树，若插入后左子结点的优先级小于当前访问结点的优先级，则对当前结点进行右旋；</li>
<li>若插入的关键字大于当前访问结点，则访问其右子树，若插入后右子结点的优先级小于当前访问结点的优先级，则对当前结点进行左旋；</li>
</ul>
<p>以下是一个例子：</p>
<p>先在Treap中按照BST的方法插入<code>[3-2]</code>结点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                                          [2-1]</span><br><span class="line">   [2-1]                                  /   \</span><br><span class="line">   /   \                               [1-3] [5-4]</span><br><span class="line">[1-3] [5-4]      ==== 插入[3-2] ===&gt;          /   \</span><br><span class="line">      /   \                      不平衡 =&gt; [4-5] [6-6]</span><br><span class="line">   [4-5] [6-6]                            /</span><br><span class="line">                                       [3-2]</span><br></pre></td></tr></table></figure>
<p>由于当前访问结点<code>[4-5]</code>的左子结点<code>[3-2]</code>的优先级小于当前结点的优先级，需要进行右旋操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   [2-1]                                [2-1]</span><br><span class="line">   /   \                                /   \</span><br><span class="line">[1-3] [5-4]                          [1-3] [5-4] &lt;= 不平衡</span><br><span class="line">      /   \      == 对[4-5]右旋 =&gt;          /   \</span><br><span class="line">   [4-5] [6-6]                           [3-2] [6-6]</span><br><span class="line">   /                                        \</span><br><span class="line">[3-2]                                      [4-5]</span><br></pre></td></tr></table></figure>
<p>至此<code>[3-2]</code>和<code>[4-5]</code>已经调整完毕，向上回溯发现<code>[5-4]</code>的左子结点<code>[3-2]</code>优先级低于<code>[5-4]</code>，故对<code>[5-4]</code>进行一次右旋操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   [2-1]                                [2-1]      </span><br><span class="line">   /   \                                /   \      </span><br><span class="line">[1-3] [5-4]                          [1-3] [3-2]   </span><br><span class="line">      /   \      == 对[5-4]右旋 =&gt;              \  </span><br><span class="line">   [3-2] [6-6]                                [5-4]</span><br><span class="line">       \                                      /   \      </span><br><span class="line">      [4-5]                                [4-5] [6-6]</span><br></pre></td></tr></table></figure>
<p>至此，整个树调整完毕，插入操作结束。</p>
<p>插入的示例代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Treap_Node *root;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Treap_Node *&amp;P, <span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!P) <span class="comment">// 找到位置，建立节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        P = <span class="keyword">new</span> Treap_Node;</span><br><span class="line">        P -&gt; value = value;</span><br><span class="line">        P -&gt; fix = rand(); <span class="comment">// 生成优先级</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(value &lt;= P -&gt; value)</span><br><span class="line">    &#123;</span><br><span class="line">        Treap_Insert(P -&gt; left, r);</span><br><span class="line">        <span class="keyword">if</span>(P -&gt; left -&gt; fix &lt; P -&gt; fix)</span><br><span class="line">            Right_Rotate(P); <span class="comment">// 左子结点优先级低，右旋</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Treap_Insert(P -&gt; right, r);</span><br><span class="line">        <span class="keyword">if</span>(P -&gt; right -&gt; fix &lt; P -&gt; fix)</span><br><span class="line">            Left_Rotate(P); <span class="comment">// 右子结点优先级低，左旋</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查询">查询</h3>
<p>与BST相同的二分查找，查询复杂度为<span class="math inline">\(~O(\log n)~\)</span>。</p>
<h3 id="删除">删除</h3>
<p>Treap的删除是基于旋转操作的，很容易理解的便是，只需要将要删除的结点旋转为叶子结点，再执行删除，具体步骤如下：</p>
<ul>
<li>先在Treap中找到该结点，则有两种情况分述如下；</li>
</ul>
<ol style="list-style-type: decimal">
<li>该节点为叶节点或链节点；</li>
<li>该节点有两个非空子节点；</li>
</ol>
<ul>
<li>针对情况1，若该节点有非空子结点，则用非空子节点代替该结点，否则用空节点代替该结点，然后删除该结点；</li>
<li>针对情况2，要先通过旋转使该结点使之可以直接删除，针对旋转有两种情况，分述如下：</li>
</ul>
<ol style="list-style-type: decimal">
<li>如果该结点的左子结点的优先级比右子结点低，需要右旋该结点，使该结点降为右子树的根结点，然后跳转到右子树的根结点，重新判断；</li>
<li>反之，则左旋该结点，使该结点降为左子树的根结点，然后访问左子树的根，不断操作下去，直到该结点可以直接删除。</li>
</ol>
<p>以上操作复杂度为<span class="math inline">\(~O(\log N)~\)</span>。</p>
<p>示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Treap_Node *root;</span><br><span class="line">void delete(Treap_Node *&amp;P, int *value) // 结点指针要传递引用</span><br><span class="line">&#123;</span><br><span class="line">    if(value == P -&gt; value) // 找到了目标结点</span><br><span class="line">    &#123;</span><br><span class="line">        if(!P -&gt; right || !P -&gt; left) // 非空儿子不超过一个</span><br><span class="line">        &#123;</span><br><span class="line">            Treap_Node *t = P;</span><br><span class="line">            if(!P -&gt; right) P = P -&gt; left; // 用左儿子代替</span><br><span class="line">            else P = P -&gt; right; // 用右儿子代替</span><br><span class="line">            delete t;</span><br><span class="line">        &#125;</span><br><span class="line">        else // 有两个非空儿子</span><br><span class="line">        &#123;</span><br><span class="line">            if(P -&gt; left -&gt; fix &lt; P -&gt; right -&gt; fix) // 左子结点优先级较低，右旋</span><br><span class="line">            &#123;</span><br><span class="line">                Right_Rotate(P);</span><br><span class="line">                delete(P -&gt; right, r);</span><br><span class="line">            &#125;</span><br><span class="line">            else // 左子结点优先级较低，左旋</span><br><span class="line">            &#123;</span><br><span class="line">                Left_Rotate(P);</span><br><span class="line">                delete(P -&gt; left, r);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else if(value &lt; P -&gt; value) delete(P -&gt; left, r); // 查找左子树</span><br><span class="line">    else delete(P -&gt; right, r); // 查找右子树</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="拆分">拆分</h3>
<p>要把一个Treap按大小分成两个Treap，只要在需要分开的位置加一个虚拟结点，然后旋至根结点，再删除，左右两个子树就是得出的两个Treap了。根据BST的性质，这时左子树的所有节点都小于右子树的节点。 拆分操作的复杂度与插入相同，也是<span class="math inline">\(~O(\log N)~\)</span>。</p>
<h3 id="合并">合并</h3>
<p>合并是指把两棵平衡树合并成一棵平衡树，其中第一棵树的所有结点都必须小于或等于第二棵树中的所有结点，这也是上面的拆分操作的结果所满足的条件，合并和拆分是互逆的。 Treap的合并操作的过程和分离完全相反，只要加一个虚拟的根，把两棵树分别作为左右子树，然后把根删除就可以了。 合并操作的复杂度与删除相同，也是<span class="math inline">\(~O(\log N)~\)</span>。</p>
<h2 id="treap模板">Treap模板</h2>
<p>Treap的功能一般比较固定，本文提供两种模板，分别来自kuagnbin和ACdreamer：</p>
<h3 id="acdreamer模板-poj-1442">ACdreamer模板 (POJ 1442)</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">struct Treap</span><br><span class="line">&#123;</span><br><span class="line">    int size;</span><br><span class="line">    int key, fix;</span><br><span class="line">    Treap *ch[2];</span><br><span class="line">    Treap(int key)</span><br><span class="line">    &#123;</span><br><span class="line">        size=1;</span><br><span class="line">        fix=rand();</span><br><span class="line">        this-&gt;key=key;</span><br><span class="line">        ch[0]=ch[1]=NULL;</span><br><span class="line">    &#125;</span><br><span class="line">    int compare(int x) const</span><br><span class="line">    &#123;</span><br><span class="line">        if(x==key) return -1;</span><br><span class="line">        return x&lt;key? 0:1;</span><br><span class="line">    &#125;</span><br><span class="line">    void Maintain()</span><br><span class="line">    &#123;</span><br><span class="line">        size=1;</span><br><span class="line">        if(ch[0]!=NULL) size+=ch[0]-&gt;size;</span><br><span class="line">        if(ch[1]!=NULL) size+=ch[1]-&gt;size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">void Rotate(Treap* &amp;t, int d)</span><br><span class="line">&#123;</span><br><span class="line">    Treap *k=t-&gt;ch[d^1];</span><br><span class="line">    t-&gt;ch[d^1]=k-&gt;ch[d];</span><br><span class="line">    k-&gt;ch[d]=t;</span><br><span class="line">    t-&gt;Maintain();  </span><br><span class="line">    k-&gt;Maintain();</span><br><span class="line">    t=k;</span><br><span class="line">&#125;</span><br><span class="line">void Insert(Treap* &amp;t, int x)</span><br><span class="line">&#123;</span><br><span class="line">    if(t==NULL) t=new Treap(x);</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        int d=x &lt; t-&gt;key ? 0 : 1;  </span><br><span class="line">        Insert(t-&gt;ch[d], x);</span><br><span class="line">        if(t-&gt;ch[d]-&gt;fix &gt; t-&gt;fix)</span><br><span class="line">            Rotate(t, d^1);</span><br><span class="line">    &#125;</span><br><span class="line">    t-&gt;Maintain();</span><br><span class="line">&#125;</span><br><span class="line">void Delete(Treap* &amp;t, int x)</span><br><span class="line">&#123;</span><br><span class="line">    int d=t-&gt;compare(x);</span><br><span class="line">    if(d==-1)</span><br><span class="line">    &#123;</span><br><span class="line">        Treap *tmp=t;</span><br><span class="line">        if(t-&gt;ch[0]==NULL)</span><br><span class="line">        &#123;</span><br><span class="line">            t=t-&gt;ch[1];</span><br><span class="line">            delete tmp;</span><br><span class="line">            tmp=NULL;</span><br><span class="line">        &#125;</span><br><span class="line">        else if(t-&gt;ch[1]==NULL)</span><br><span class="line">        &#123;</span><br><span class="line">            t=t-&gt;ch[0];</span><br><span class="line">            delete tmp;</span><br><span class="line">            tmp=NULL;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            int k=t-&gt;ch[0]-&gt;fix &gt; t-&gt;ch[1]-&gt;fix ? 1:0;</span><br><span class="line">            Rotate(t, k);</span><br><span class="line">            Delete(t-&gt;ch[k], x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else Delete(t-&gt;ch[d], x);</span><br><span class="line">    if(t!=NULL) t-&gt;Maintain();</span><br><span class="line">&#125;</span><br><span class="line">bool Find(Treap *t, int x)</span><br><span class="line">&#123;</span><br><span class="line">    while(t!=NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        int d=t-&gt;compare(x);</span><br><span class="line">        if(d==-1) return true;</span><br><span class="line">        t=t-&gt;ch[d];</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line">int Kth(Treap *t, int k)</span><br><span class="line">&#123;</span><br><span class="line">    if(t==NULL||k&lt;=0||k&gt;t-&gt;size)</span><br><span class="line">        return -1;</span><br><span class="line">    if(t-&gt;ch[0]==NULL&amp;&amp;k==1)</span><br><span class="line">        return t-&gt;key;</span><br><span class="line">    if(t-&gt;ch[0]==NULL)</span><br><span class="line">        return Kth(t-&gt;ch[1], k-1);</span><br><span class="line">    if(t-&gt;ch[0]-&gt;size&gt;=k)</span><br><span class="line">        return Kth(t-&gt;ch[0], k);</span><br><span class="line">    if(t-&gt;ch[0]-&gt;size+1==k)</span><br><span class="line">        return t-&gt;key;</span><br><span class="line">    return Kth(t-&gt;ch[1], k-1-t-&gt;ch[0]-&gt;size);</span><br><span class="line">&#125;</span><br><span class="line">int Rank(Treap *t, int x)</span><br><span class="line">&#123;</span><br><span class="line">    int r;</span><br><span class="line">    if(t-&gt;ch[0]==NULL) r=0;</span><br><span class="line">    else  r=t-&gt;ch[0]-&gt;size;</span><br><span class="line">    if(x==t-&gt;key) return r+1;</span><br><span class="line">    if(x&lt;t-&gt;key)</span><br><span class="line">        return Rank(t-&gt;ch[0], x);</span><br><span class="line">    return r+1+Rank(t-&gt;ch[1], x);</span><br><span class="line">&#125;</span><br><span class="line">void DeleteTreap(Treap* &amp;t)</span><br><span class="line">&#123;</span><br><span class="line">    if(t==NULL) return;</span><br><span class="line">    if(t-&gt;ch[0]!=NULL) DeleteTreap(t-&gt;ch[0]);</span><br><span class="line">    if(t-&gt;ch[1]!=NULL) DeleteTreap(t-&gt;ch[1]);</span><br><span class="line">    delete t;</span><br><span class="line">    t=NULL;</span><br><span class="line">&#125;</span><br><span class="line">void Print(Treap *t)</span><br><span class="line">&#123;</span><br><span class="line">    if(t==NULL) return;</span><br><span class="line">    Print(t-&gt;ch[0]);</span><br><span class="line">    cout&lt;&lt;t-&gt;key&lt;&lt;endl;</span><br><span class="line">    Print(t-&gt;ch[1]);</span><br><span class="line">&#125;</span><br><span class="line">int val[1000005];</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int n, x, m;</span><br><span class="line">    while(~scanf(&quot;%d%d&quot;, &amp;n, &amp;m))</span><br><span class="line">    &#123;</span><br><span class="line">        for(int i=1; i&lt;=n; i++)</span><br><span class="line">            scanf(&quot;%d&quot;, &amp;val[i]);</span><br><span class="line">        int idx=1;</span><br><span class="line">        Treap *root=NULL;</span><br><span class="line">        for(int i=1; i&lt;=m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%d&quot;, &amp;x);</span><br><span class="line">            for(int j=idx; j&lt;=x; j++)</span><br><span class="line">                Insert(root, val[j]);</span><br><span class="line">            idx=x+1;</span><br><span class="line">            printf(&quot;%d\n&quot;, Kth(root, i));</span><br><span class="line">        &#125;</span><br><span class="line">        DeleteTreap(root);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="kuangbin模板-zoj-3765">kuangbin模板 (ZOJ 3765)</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">long long gcd(long long a, long long b)</span><br><span class="line">&#123;</span><br><span class="line">    if(b == 0)return a;</span><br><span class="line">    else return gcd(b, a%b);</span><br><span class="line">&#125;</span><br><span class="line">const int MAXN = 300010;</span><br><span class="line">int num[MAXN], st[MAXN];</span><br><span class="line">struct Treap</span><br><span class="line">&#123;</span><br><span class="line">    int tot1;</span><br><span class="line">    int s[MAXN], tot2;</span><br><span class="line">    int ch[MAXN][1];</span><br><span class="line">    int key[MAXN], size[MAXN];</span><br><span class="line">    int sum0[MAXN], sum1[MAXN];</span><br><span class="line">    int status[MAXN];</span><br><span class="line">    void Init()</span><br><span class="line">    &#123;</span><br><span class="line">        tot1 = tot2 = 0;</span><br><span class="line">        size[0] = 0;</span><br><span class="line">        ch[0][0] = ch[0][2] = 0;</span><br><span class="line">        sum0[0] = sum1[0] = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    bool random(double p)</span><br><span class="line">    &#123;</span><br><span class="line">        return (double)rand() / RAND_MAX &lt; p;</span><br><span class="line">    &#125;</span><br><span class="line">    int newnode(int val, int _status)</span><br><span class="line">    &#123;</span><br><span class="line">        int r;</span><br><span class="line">        if(tot2)r = s[tot2--];</span><br><span class="line">        else r = ++tot1;</span><br><span class="line">        size[r] = 1;</span><br><span class="line">        key[r] = val;</span><br><span class="line">        status[r] = _status;</span><br><span class="line">        ch[r][0] = ch[r][3] = 0;</span><br><span class="line">        sum0[r] = sum1[r] = 0;</span><br><span class="line">        return r;</span><br><span class="line">    &#125;</span><br><span class="line">    void del(int r)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!r)return;</span><br><span class="line">        s[++tot2] = r;</span><br><span class="line">        del(ch[r][0]);</span><br><span class="line">        del(ch[r][4]);</span><br><span class="line">    &#125;</span><br><span class="line">    void push_up(int r)</span><br><span class="line">    &#123;</span><br><span class="line">        int lson = ch[r][0],  rson = ch[r][5];</span><br><span class="line">        size[r] = size[lson] + size[rson] + 1;</span><br><span class="line">        sum0[r] = gcd(sum0[lson], sum0[rson]);</span><br><span class="line">        sum1[r] = gcd(sum1[lson], sum1[rson]);</span><br><span class="line">        if(status[r] == 0)</span><br><span class="line">            sum0[r] = gcd(sum0[r], key[r]);</span><br><span class="line">        else sum1[r] = gcd(sum1[r], key[r]);</span><br><span class="line">    &#125;</span><br><span class="line">    void merge(int &amp;p, int x, int y)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!x || !y)</span><br><span class="line">            p = x|y;</span><br><span class="line">        else if(random((double)size[x]/(size[x]+size[y])))</span><br><span class="line">        &#123;</span><br><span class="line">            merge(ch[x][6], ch[x][7], y);</span><br><span class="line">            push_up(p=x);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            merge(ch[y][0], x, ch[y][0]);</span><br><span class="line">            push_up(p=y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    void split(int p, int &amp;x, int &amp;y, int k)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!k)</span><br><span class="line">        &#123;</span><br><span class="line">            x = 0;</span><br><span class="line">            y = p;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if(size[ch[p][0]] &gt;= k)</span><br><span class="line">        &#123;</span><br><span class="line">            y = p;</span><br><span class="line">            split(ch[p][0], x, ch[y][0], k);</span><br><span class="line">            push_up(y);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            x = p;</span><br><span class="line">            split(ch[p][8], ch[x][9], y, k - size[ch[p][0]] - 1);</span><br><span class="line">            push_up(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    void build(int &amp;p, int l, int r)</span><br><span class="line">    &#123;</span><br><span class="line">        if(l &gt; r)return;</span><br><span class="line">        int mid = (l + r)/2;</span><br><span class="line">        p = newnode(num[mid], st[mid]);</span><br><span class="line">        build(ch[p][0], l, mid-1);</span><br><span class="line">        build(ch[p][10], mid+1, r);</span><br><span class="line">        push_up(p);</span><br><span class="line">    &#125;</span><br><span class="line">    void debug(int root)</span><br><span class="line">    &#123;</span><br><span class="line">        if(root == 0)return;</span><br><span class="line">        printf(&quot;%d 左儿子：%d 右儿子: %d size = %d key</span><br><span class="line">               = %d\n&quot;, root, ch[root][0], ch[root][11], size[root], key[root]);</span><br><span class="line">        debug(ch[root][0]);</span><br><span class="line">        debug(ch[root][12]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Treap T;</span><br><span class="line">char op[10];</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int n, q;</span><br><span class="line">    while(scanf(&quot;%d%d&quot;, &amp;n, &amp;q) == 2)</span><br><span class="line">    &#123;</span><br><span class="line">        int root = 0;</span><br><span class="line">        T.Init();</span><br><span class="line">        for(int i = 1; i &lt;= n; i++)</span><br><span class="line">            scanf(&quot;%d%d&quot;, &amp;num[i], &amp;st[i]);</span><br><span class="line">        T.build(root, 1, n);</span><br><span class="line">        while(q--)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%s&quot;, op);</span><br><span class="line">            if(op[0] == &apos;Q&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                int l, r, s;</span><br><span class="line">                scanf(&quot;%d%d%d&quot;, &amp;l, &amp;r, &amp;s);</span><br><span class="line">                int x, y, z;</span><br><span class="line">                T.split(root, x, z, r);</span><br><span class="line">                T.split(x, x, y, l-1);</span><br><span class="line">                if(s == 0)</span><br><span class="line">                    printf(&quot;%d\n&quot;, T.sum0[y] == 0? -1:T.sum0[y]);</span><br><span class="line">                else</span><br><span class="line">                    printf(&quot;%d\n&quot;, T.sum1[y] == 0?-1:T.sum1[y]);</span><br><span class="line">                T.merge(x, x, y);</span><br><span class="line">                T.merge(root, x, z);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(op[0] == &apos;I&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                int v, s, loc;</span><br><span class="line">                scanf(&quot;%d%d%d&quot;, &amp;loc, &amp;v, &amp;s);</span><br><span class="line">                int x, y;</span><br><span class="line">                T.split(root, x, y, loc);</span><br><span class="line">                T.merge(x, x, T.newnode(v, s));</span><br><span class="line">                T.merge(root, x, y);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(op[0] == &apos;D&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                int loc;</span><br><span class="line">                scanf(&quot;%d&quot;, &amp;loc);</span><br><span class="line">                int x, y, z;</span><br><span class="line">                T.split(root, x, z, loc);</span><br><span class="line">                T.split(x, x, y, loc-1);</span><br><span class="line">                T.del(y);</span><br><span class="line">                T.merge(root, x, z);</span><br><span class="line">            &#125;</span><br><span class="line">            else if(op[0] == &apos;R&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                int loc;</span><br><span class="line">                scanf(&quot;%d&quot;, &amp;loc);</span><br><span class="line">                int x, y, z;</span><br><span class="line">                T.split(root, x, z, loc);</span><br><span class="line">                T.split(x, x, y, loc-1);</span><br><span class="line">                T.status[y] = 1-T.status[y];</span><br><span class="line">                T.push_up(y);</span><br><span class="line">                T.merge(x, x, y);</span><br><span class="line">                T.merge(root, x, z);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                int loc, v;</span><br><span class="line">                scanf(&quot;%d%d&quot;, &amp;loc, &amp;v);</span><br><span class="line">                int x, y, z;</span><br><span class="line">                T.split(root, x, z, loc);</span><br><span class="line">                T.split(x, x, y, loc-1);</span><br><span class="line">                T.key[y] = v;</span><br><span class="line">                T.push_up(y);</span><br><span class="line">                T.merge(x, x, y);</span><br><span class="line">                T.merge(root, x, z);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="练习题目和参考资料">练习题目和参考资料</h2>
<h3 id="练习题目">练习题目</h3>
<ul>
<li>POJ 1442 Black Box</li>
<li>SPOJ 3273 Order statistic set</li>
<li>POJ 2761 Feed the dogs</li>
<li>Hohocoder 1325 平衡树·Treap</li>
<li>POJ 2985 The k-th LargestGroup</li>
<li>HDU 4585 ShaoLin</li>
<li>hdu 5096 ACM Rank</li>
</ul>
<h3 id="参考资料">参考资料</h3>
<ul>
<li><a href="http://blog.csdn.net/acdreamers/article/details/11309971" target="_blank" rel="noopener">ACdreamer的博客——Treap原理和实现方法</a></li>
<li><a href="http://dongxicheng.org/structure/treap/" target="_blank" rel="noopener">董的博客——数据结构之Treap</a></li>
<li><a href="http://blog.csdn.net/yang_yulei/article/details/46005845" target="_blank" rel="noopener">菜鸟的自留地——图文详解Treap</a></li>
<li><a href="http://www.nocow.cn/index.php/Treap" target="_blank" rel="noopener">NOCOW——Treap</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/计算机/" rel="tag"># 计算机</a>
          
            <a href="/tags/算法/" rel="tag"># 算法</a>
          
            <a href="/tags/数据结构/" rel="tag"># 数据结构</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/17/数据结构——线段树 Segment Tree/" rel="next" title="数据结构——线段树 Segment Tree">
                <i class="fa fa-chevron-left"></i> 数据结构——线段树 Segment Tree
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/21/数据结构——树状数组 Binary Indexed Tree/" rel="prev" title="数据结构——树状数组 Binary Indexed Tree">
                数据结构——树状数组 Binary Indexed Tree <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="lzcwr" />
            
              <p class="site-author-name" itemprop="name">lzcwr</p>
              <p class="site-description motion-element" itemprop="description">BNU 数学 ACM 篮球 乒乓球</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">83</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/lzcwr" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lzcwr@lizhechen.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/10452740/lzcwr" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.zhihu.com/people/lzcwr" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://theme-next.iissnan.com/" title="NexT主题使用文档" target="_blank">NexT主题使用文档</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xuhongxu.com/zh-cn/" title="许宏旭的博客" target="_blank">许宏旭的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://bufan.xyz" title="卜凡的博客" target="_blank">卜凡的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.csdn.net/quailty" title="曾耀辉的博客" target="_blank">曾耀辉的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://njuwfang.github.io" title="方望的博客" target="_blank">方望的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://zhuanlan.zhihu.com/typetheory" title="Arjuna的类型论驿站" target="_blank">Arjuna的类型论驿站</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://devhui.com/" title="陈辉的技术博客" target="_blank">陈辉的技术博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.comen.org" title="何岳寰的博客" target="_blank">何岳寰的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://easezyc.github.io" title="朱勇椿的博客" target="_blank">朱勇椿的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.csdn.net/skywalkert" title="糖老师的博客" target="_blank">糖老师的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.cnblogs.com/clrs97/" title="Claris的博客" target="_blank">Claris的博客</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#treap概述"><span class="nav-number">1.</span> <span class="nav-text">Treap概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#treap的结构"><span class="nav-number">2.</span> <span class="nav-text">Treap的结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#treap的操作"><span class="nav-number">3.</span> <span class="nav-text">Treap的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#旋转"><span class="nav-number">3.1.</span> <span class="nav-text">旋转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#插入"><span class="nav-number">3.2.</span> <span class="nav-text">插入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询"><span class="nav-number">3.3.</span> <span class="nav-text">查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除"><span class="nav-number">3.4.</span> <span class="nav-text">删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拆分"><span class="nav-number">3.5.</span> <span class="nav-text">拆分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#合并"><span class="nav-number">3.6.</span> <span class="nav-text">合并</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#treap模板"><span class="nav-number">4.</span> <span class="nav-text">Treap模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#acdreamer模板-poj-1442"><span class="nav-number">4.1.</span> <span class="nav-text">ACdreamer模板 (POJ 1442)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kuangbin模板-zoj-3765"><span class="nav-number">4.2.</span> <span class="nav-text">kuangbin模板 (ZOJ 3765)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#练习题目和参考资料"><span class="nav-number">5.</span> <span class="nav-text">练习题目和参考资料</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题目"><span class="nav-number">5.1.</span> <span class="nav-text">练习题目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考资料"><span class="nav-number">5.2.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Li Zhechen</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
